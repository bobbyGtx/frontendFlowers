<div class="order">
  <div class="container">
    <div class="order-title">Оформление вашего заказа</div>
    <div class="order-info" *ngIf="cart && deliveryTypes.length && activeDeliveryType">
      <div class="order-form" [formGroup]="orderForm">
        <div class="order-form-block">
          <div class="order-form-label">Выберите способ доставки</div>
          <div class="order-form-types">
            <div class="order-form-type-item" *ngFor="let deliveryType of deliveryTypes"
                 [class.active]="activeDeliveryType.id === deliveryType.id"
                 [class.disabled]="deliveryType.disabled"
                 [matTooltip]="deliveryType.disabled?'Метод доставки не доступен':''"
                 matTooltipClass="mat-tooltip-compact"
                 matTooltipPosition="below"
                 matTooltipHideDelay="200"
                 (click)="changeDeliveryType(deliveryType)">{{ deliveryType.deliveryType }}
            </div>
          </div>
        </div>

        <div class="order-form-block">
          <div class="order-form-label">Заполните личные данные</div>
          <div class="order-form-inputs personal-data-inputs">
            <input type="text" class="input" placeholder="Имя" [ngStyle]="{'border-color':firstName?.invalid &&(firstName?.dirty||firstName?.touched)?'red':''}" formControlName="firstName">
            <input type="text" class="input" placeholder="Фамилия" [ngStyle]="{'border-color':lastName?.invalid &&(lastName?.dirty||lastName?.touched)?'red':''}" formControlName="lastName">
            <input type="text" class="input" placeholder="Телефон" [ngStyle]="{'border-color':phone?.invalid &&(phone?.dirty||phone?.touched)?'red':''}" formControlName="phone">
            <input type="text" class="input" placeholder="E-Mail" [ngStyle]="{'border-color':email?.invalid &&(email?.dirty||email?.touched)?'red':''}" formControlName="email">
          </div>
        </div>

        <div class="order-form-block" *ngIf="activeDeliveryType.addressNeed">
          <div class="order-form-label">Заполните адрес доставки</div>
          <div class="order-form-inputs address-data-inputs">
            <select name="region" class="input region" id="region" [ngStyle]="{'border-color':region?.invalid &&(region?.dirty||region?.touched)?'red':''}" formControlName="region">
              <option [value]="region" *ngFor="let region of regionList">{{region}}</option>
            </select >
            <input type="text" class="input town" placeholder="Город" [ngStyle]="{'border-color':city?.invalid &&(city?.dirty||city?.touched)?'red':''}" formControlName="city">
            <input type="text" class="input zip" placeholder="Индекс" [ngStyle]="{'border-color':zip?.invalid &&(zip?.dirty||zip?.touched)?'red':''}" formControlName="zip">
            <input type="text" class="input street" placeholder="Улица" [ngStyle]="{'border-color':street?.invalid &&(street?.dirty||street?.touched)?'red':''}" formControlName="street">
            <input type="text" class="input house" placeholder="№ дома" [ngStyle]="{'border-color':house?.invalid &&(house?.dirty||house?.touched)?'red':''}" formControlName="house">
          </div>
        </div>

        <div class="order-form-block">
          <div class="order-form-label">Выберите способ оплаты</div>
          <div class="order-form-radio">
            <div class="order-form-radio-block" *ngFor="let paymentType of paymentTypes">
              <input type="radio" [id]="'radio_'+paymentType.id" [value]="paymentType.id" formControlName="paymentType">
              <label [for]="'radio_'+paymentType.id">{{paymentType.paymentType}}</label>
            </div>
          </div>
        </div>

        <div class="order-form-block">
          <div class="order-form-label">Комментарий к заказу (необязательно)</div>
          <div class="order-form-inputs">
            <textarea cols="30" rows="5" maxlength="500" [ngStyle]="{'border-color':comment?.invalid &&(comment?.dirty||comment?.touched)?'red':''}" class="input" placeholder="Оставьте свой комментарий..." formControlName="comment"></textarea>
          </div>
        </div>

      </div>

      <div class="order-details">
        <div class="order-details-info">
          <div class="order-details-info-title">Ваш заказ</div>
          <div class="order-details-info-item">
            <div class="order-details-info-item-caption">Товаров:</div>
            <div class="order-details-info-item-data">{{ cart.count }}</div>
          </div>
          <div class="order-details-info-item">
            <div class="order-details-info-item-caption">Общая стоимость:</div>
            <div class="order-details-info-item-data">{{ cart.amount }} EUR</div>
          </div>
          <div class="order-details-info-item">
            <div class="order-details-info-item-caption">Стоимость доставки:</div>
            <div class="order-details-info-item-data"
                 [class.not-valid]="lowDeliveryPrice">{{ activeDeliveryType.delivery_price }} EUR
              <svg *ngIf="activeDeliveryType.lPMinPrice>0 && !lowDeliveryPrice"
                   [matTooltip]="'Cкидка на доставку при покупке от '+ activeDeliveryType.lPMinPrice +' EUR'"
                   matTooltipClass="mat-tooltip-compact"
                   matTooltipPosition="below"
                   matTooltipHideDelay="200"
                   class="attention-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="9" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2"/>
                <rect height="0.01" stroke-linejoin="round" stroke-width="3" width="0.01" x="12"
                      y="16"/>
                <path d="M12 12L12 8" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
              </svg>
            </div>

          </div>
          <div class="order-details-info-item discount" *ngIf="lowDeliveryPrice">
            <div class="order-details-info-item-caption">Скидка на доставку:</div>
            <div
              class="order-details-info-item-data">{{ activeDeliveryType.low_price - activeDeliveryType.delivery_price }}
              EUR
            </div>

          </div>
          <div class="order-details-info-item">
            <div class="order-details-info-item-caption">Итоговая стоимость:</div>
            <div class="order-details-info-item-data">{{ finalAmount }} EUR</div>
          </div>
        </div>
        <button class="button" (click)="createOrder()">Подтвердить заказ</button> <!--[disabled]="orderForm.invalid"-->
      </div>
    </div>
  </div>
</div>

<ng-template #popup>
  <div class="order-popup">
    <div class="order-popup-close" mat-dialog-close>
      <svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
        <line x1="1.93562" y1="2.6499" x2="13.9564" y2="14.6707" stroke-linecap="round"/>
        <line x1="13.9238" y1="2.62971" x2="1.90301" y2="14.6505" stroke-linecap="round"/>
      </svg>
    </div>
    <div class="order-popup-title">Благодарим за заказ!</div>
    <div class="order-popup-content">
      <div>Ваш заказ оформлен.</div>
      <div>Вся информация о заказе была выслана вам на почту.</div>
      <div>Курьер свяжется с вами за два часа до доставки товара.</div>

    </div>

  </div>
</ng-template>
